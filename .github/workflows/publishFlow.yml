name: Push to Production

on:
  push:
    branches: [main] # 只有推送到 main 分支时触发
jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      # 核心：触发webhook
      - name: Notify server via webhook
        continue-on-error: true
        run: |
          curl -X POST "${{ secrets.DEPLOY_URL }}" \
            -H "token: ${{ secrets.DEPLOY_TOKEN }}" \
            --data-urlencode "projectPath=${{ secrets.PROJECT_PATH }}" \
            --data-urlencode "deployPath=${{ secrets.DEPLOY_PATH }}" \
            --data-urlencode "deployType=${{ secrets.DEPLOY_TYPE }}"\
            --max-time 600 \
            --connect-timeout 30 \
            --retry 3 \
            --retry-delay 5 \
            --silent \
            --show-error
